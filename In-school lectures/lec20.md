# Lec20: 输入/输出
## 概述
输入输出简称I/O，是程序的重要组成部分
由具体的**标准库**的功能来提供
输入/输出操作往往是带**内存缓冲区**的，解决内存与外设存取速度不匹配问题，提高效率：
- 输出时，输出的数据先放内存缓冲区中，缓冲区**满了之后再实际输出到外设**。
- 输入时，先从外设输入一大块内容**放入内存缓冲区**，然后从缓冲区中**逐步输入**数据。

### printf、scanf的缺陷
过程式，从C语言的函数库保留而来的
printf和scanf是两个带可变参数的函数，它们的第一个参数为一个格式串，指出后面要输入/输出的**数据的类型和个数**。
类型不安全，可能导致类型或者个数不一致，造成运行错误

### cin、cout的优势
面向对象的输入输出，用相应的输入输出类和重载过后的`<<`和`>>`实现
不需要专门指定数据的类型和个数，**编译时刻**根据数据本身来决定数据的类型和个数，可以避免与类型和个数相关的错误

### I/O的分类
- 面向控制台的I/O，从标准输入设备（键盘）获得数据，运行结果从标准输出设备（显示器）输出
- 面向文件的I/O，从外存（磁盘）获得数据，运行结果保存在外存中
- 面向字符串变量的I/O，从程序中的字符串变量获得数据，把运行结果保存到字符串变量中

### C++的I/O类库中基本的类
![1762754770162](image/lec20/1762754770162.png)
istream只能输入，ostream只能输出
想要既能输入又能输出，就需要iostream这个类，是从istream和ostream**多继承**而来的

#### 基于I/O类库进行I/O的**基本步骤**
首先要创建某个I/O类的一个**对象**，然后，调用该对象类的**成员函数**进行基于**字节流**的输入/输出操作。

比如控制台输入：
```cpp
istream in(...); //创建istream类的一个对象in
in.get(ch); //读入一个字节，ch为一个字符变量
in.read(p,100); //每次读入100个字节，放入p中，p是内存空间首地址
```
控制台输出：
```cpp
ostream out(...); //创建ostream类的一个对象out
out.put(ch); //输出一个字节，ch为一个字符变量
out.write(p,100); //把p指向的内存中100个字节输出
```

标准库中的I/O类还针对输入/输出类分别重载了操作符`>>`（抽取）和`<<`（插入），用它们可以进行C++基本类型数据的输入/输出操作。
```cpp
//控制台输入
istream in(...);
in >> x; //x是一个基本数据类型的变量
in >> y; //y是一个基本数据类型的变量
//控制台输出
ostream out(...);
out << e1; //e1是一个表达式
out << e2; //e2是一个表达式
```
用操作符`>>`进行输入时，它把输入的内容看成是一个**字符串**，会自动进行从字符串到基本数据类型的**转换**。
用操作符`<<`进行输出时，它会把基本数据类型的数据**转换成字符串输出**。

## 面向控制台的I/O
在I/O类库中**预定义**了四个I/O对象，可以直接用来进行**控制台的输入/输出操作**
- cin：istream类的对象，对应**标准输入设备**
- cout：ostream类的对象，对应**标准输出设备**
- cerr和clog：ostream类的对象，对应着计算机系统用于输出**特殊信息**（如程序错误信息）的设备。（通常也对应着显示器，但不受**输出重定向**的影响）。cerr为不带缓冲的，clog为带缓冲的。

在进行控制台输入/输出时，程序中需要有 `#include <iostream>` 这个命令

输入/输出重定向：`C>program.exe <a.txt >b.txt`
程序中所有cin从文件a.txt中获得输入，<号代表输入的文件
程序中所有cout输出到文件b.txt中，>号代表输出的文件

### 控制台的输出操作
用插入操作符`<<`进行基本数据类型数据的输出
特殊情况：输出**指向字符的指针**时，并不是输出指针的值（地址），而是输出它指向的字符串。
如果要输出字符指针的值，需要把它转换成其它类型的指针，比如转换成void *类型

#### 输出格式控制
可以通过输出一些**操纵符**（manipulator）来实现
```cpp
#include <iostream>
#include <iomanip>  //操纵符声明的头文件。
using namespace std;
.....
int x=10;
cout << hex << x << endl; //以十六进制输出x的值，然后换行。
```
![1762755853959](image/lec20/1762755853959.png)
对于浮点数（float、double和long double）：
- 当输出格式为`ios::scientific`或`ios::fixed`时，操纵符setprecision用于设置浮点数**小数点后面的位数**
- 当输出格式为自动方式（既不是ios::scientific也不是ios::fixed，或两者同时设了）时，操纵符setprecision用于设置浮点数**有效数字的个数**，这时的输出格式根据有效数字自动确定。

除了用操作符`<<`进行基本数据类型的输出外，也可以用ostream类的成员函数进行**基于字节**的控制台输出操作。
```cpp
//输出一个字节。
ostream& ostream::put(char ch); 
cout.put('A');
//输出p所指向的内存空间中count个字节。
ostream& ostream::write(const char *p,int count);
char info[100];  
int n;
......
cout.write(info,n); 
```

### 控制台的输入操作
用抽取操作符`>>`进行基本数据类型数据的控制台输入。

用抽取操作符>>进行输入时，各个数据之间一般要用**空白符**（空格、\t、\n）分开：
输入一个数据前，先**跳过空白符**
输入一个数据的过程中，碰到空白符或当前数据类型**不允许的字符**时，**结束**当前数据的输入

可以通过一些**操纵符**来控制输入的行为
```cpp
char str[10];
cin >> setw(10) >> str; //把输入的字符串和一个'\0'放入str中，也就是最多输入9个字符
// 多的字符放在输入缓冲区之中。
// 如果不加这个函数，可能会让str这个空间出问题，被撑爆
```

除了用操作符`>>`进行基本数据类型的输入外，也可以用istream类的成员函数进行**基于字节**的控制台输入操作。
```cpp
//输入一个字节到ch中。
istream& istream::get(char &ch); 
//输入count个字节至p所指向的内存空间中。
istream& istream::read(char *p,int count);
//输入一个字符串放入p指向的内存空间中。输入过程直到输入了count-1个字符或遇到delim指定的字符为止，并自动在最后加上一个'\0'字符。
istream& istream::get(char *p, int count, char delim='\n'); 
istream& istream::getline(char *p, int count, char delim='\n');
```
用istream类的成员函数进行输入时，**空白符**也会作为字符输入！
因此如果要输入一个带空格的字符串，就用get或者getline，不会因为空白符结束

另外，可以用下面的成员函数**跳过**输入缓存中的若干字符
```cpp
cin.ignore(n,'\n'); //跳过输入缓存中n个字符，或碰到回车
//例如：
char str[5]; int x;
cin.get(str,5); //输入：abcdefg↙，只读入abcd，efg留在输入缓冲区中
cin.ignore(20,'\n'); //跳过输入缓冲区中遗留的efg
cin >> x; //输入：12↙，x得到12，它输入缓冲区中遗留的efg已经被跳过
```

### 操作符`>>`和`<<`的重载
重载之后的这两个操作符只能进行基本数据类型的输入输出
自定义类型的对象，可以再对这两个操作符进行自定义的重载，就可以进行自定义对象的输入输出

例子：实现复数类的输出
```cpp
class Complex
{  ......
    friend ostream& operator << (ostream &out, const Complex &c);
  private：
	double real;
	double imag;			
};
ostream& operator << (ostream &out, const Complex &c)
{	out << c.real << '+' << c.imag << 'i';
	return out;
}
.....
Complex c1,c2;
cout << c1 << endl << c2 << endl;
```

## 面向文件的I/O
用于永久性保存数据的设备称为**外部存储器**（简称：外存），比如磁盘、光盘等

### 文件
